function GetRequest(){var e=location.search,t=new Object;if(-1!=e.indexOf("?")){var a=e.substr(1);strs=a.split("&");for(var o=0;o<strs.length;o++)t[strs[o].split("=")[0]]=unescape(strs[o].split("=")[1])}return t}function taskMsg(){var e={pageNo:taskData.pageNo};e.pageNo=+e.pageNo||1,e.pageNo<0&&(e.pageNo=1),taskData.pageNo=e.pageNo,$.ajax({url:"online/client/job/list",data:{pageNo:taskData.pageNo,pageSize:taskData.pageSize,fromId:taskData.fromId},success:function(t){if(t.model.totalPage&&t.model.totalPage<e.pageNo)return taskData.pageNo=t.model.totalPage,void taskMsg();t.model.data=t.model.data.map(function(e){return e.periodStr=common_js_lang[e.periodStr]+(-1==["job.period.PeriodOnceOntime","job.period.PeriodOnceImmed"].indexOf(e.periodStr)?common_js_lang["client.text.exec"]:""),e}),$(".dispatchList").html(template("template/task",{data:t.model.data})),$(".dispatchList .pager").bootpag({total:t.model.totalPage,page:t.model.currentPage,maxVisible:5,leaps:!1,firstLastUse:!0,prev:"<i>〈</i>",next:"<i>〉</i>",first:"<i>《</i>",last:"<i>》</i>"}).off().on("page",function(e,t){taskData.pageNo=t,taskMsg()})}})}function eventBind(){$(".newTask").click(function(){location.href="./client.task?clientId="+GetRequest().id}),$("body").on("click",".watchRecord",function(){var e=$(this).attr("jobid");location.href="./task.detail?jobId="+e+"&pid=0"}),$("body").on("mouseenter",".watchRecord",function(e){var t="<p class='nameTip' style='color:#999;box-shadow:2px 3px #888;background-image:linear-gradient(to bottom,#fff,#eee);position:fixed;top:"+parseInt(e.clientY+20)+"px;left:"+parseInt(e.clientX-40)+"px;line-height:20px;padding-left:8px;padding-right:8px;background:#FFF;border-radius:3px;width:auto;border:1px solid #e1e1e1;z-index:30;'>"+common_js_lang["clientM.title.viewRunLog"]+"</p>";$("body").append(t)}),$("body").on("mouseleave",".watchRecord",function(e){$(".nameTip").remove()}),$("body").on("click",".taskEdit",function(){$(this).attr("field");var e=$(this).attr("jobid");location.href="./client.task?clientId="+GetRequest().id+"&jobId="+e}),$("body").on("mouseenter",".taskEdit",function(e){var t="<p class='nameTip' style='color:#999;box-shadow:2px 3px #888;background-image:linear-gradient(to bottom,#fff,#eee);position:fixed;top:"+parseInt(e.clientY+10)+"px;left:"+parseInt(e.clientX-30)+"px;line-height:20px;padding-left:8px;padding-right:8px;background:#FFF;border-radius:3px;width:auto;border:1px solid #e1e1e1;z-index:30;'>"+common_js_lang["clientM.title.editTask"]+"</p>";$("body").append(t)}),$("body").on("mouseleave",".taskEdit",function(e){$(".nameTip").remove()}),$("body").on("click",".del",function(){var e=$(this).parents(".taskExplain").attr("field");$(this);swal({title:"",text:common_js_lang["manage.info.isDelTask"]+"["+e+"]?",type:"info",showCancelButton:!0},function(){$.ajax({url:"job/delete",type:"post",contentType:"application/x-www-form-urlencoded",data:{id:e},success:function(e){200==e.code?(MsgTip({title:"SUCCESS",text:common_js_lang["manage.info.delSucc"],type:"success",timer:2e3}),taskMsg()):ErrTip(e.i18nMsg.title,e.i18nMsg.detail,e.msg)}})})})}function init(){eventBind()}$.ajaxSetup({cache:!1}),template.helper("cronParse",function(e){var t=[];return"* * * * * ?"==e?"atOnce":7==(t=e.split(" ")).length?"onceTime":0==parseInt(t[0])&&parseInt(t[1])&&"*"==t[2]?"hour":parseInt(t[1])&&parseInt(t[2])&&"*"==t[3]&&"*"==t[4]?"day":parseInt(t[1])&&parseInt(t[2])&&"?"==t[3]&&"*"==t[4]?"week":"month"}),template.helper("getDate",function(e){var t=new Date(e);return t=t.toLocaleDateString().replace(/\//g,"/")});var taskData={};taskData.pageNo=1,taskData.pageSize=5,taskData.fromId=GetRequest().id,taskMsg(),setInterval("taskMsg()",1e4),init();